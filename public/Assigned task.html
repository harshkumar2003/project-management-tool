<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assigned task</title>
    <link rel="stylesheet" href="home.css">
</head>

<body>
    <div class="nav-main">

        <div class="navbar">
            <ul>
                <li><a href="http://127.0.0.1:5500/index.html">Home</a></li>

                <li class="dropdown">
                    <button onclick="myFunction()" class="dropbtn">Manage
                        <i class="fa-solid fa-circle-chevron-down"></i>
                    </button>
                    <div id="myDropdown" class="dropdown-content">
                        <a href="#">Assigned Task</a>
                    </div>
                </li>
                <li><a href="#">About-us</a></li>
            </ul>
        </div>
        <div class="centre">
            <img src="logo.png" alt="logo">
        </div>
        <div class="user">
            <button onclick="document.getElementById('id03').style.display='block'" class="btn1" id="info" name="info">
                <span class="material-symbols-outlined">account_circle</span>
            </button>
            <div id="user-email"></div> <!-- This is where the user's email will be displayed -->
            <button onclick="logout()" class="btn1" id="logout" name="logout">Logout</button>
        </div>
    </div>
    <div class="main">
        <h4>Yor Assigned Work</h4>
        <ul id="task-list">
            <!-- Task items will be dynamically added here using JavaScript -->
        </ul>


    </div>

</body>
<script src="script1.js"></script>
<script src="https://kit.fontawesome.com/fd42e4e9fb.js" crossorigin="anonymous"></script>
<!-- <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js"></script>
<script src="assigned-task.js"></script> -->

<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";
    import { getDatabase, ref, set, get, push } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
    //import { getAuth } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyBqyYXndru5uVI60tp6eu3A1A7Jho-1Fys",
        authDomain: "login-auth-7a8b9.firebaseapp.com",
        databaseURL: "https://login-auth-7a8b9-default-rtdb.firebaseio.com",
        projectId: "login-auth-7a8b9",
        storageBucket: "login-auth-7a8b9.appspot.com",
        messagingSenderId: "786370328154",
        appId: "1:786370328154:web:75193de1d672e27e700a63"
    };
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics();
    const auth = getAuth(app);
    const database = getDatabase(app);
    const user = auth.currentUser;
    console.log(app);
    console.log(database);
    document.addEventListener("DOMContentLoaded", function () {
        document.getElementById('info').addEventListener("click", function () {
            const user = auth.currentUser;
            if (user !== null) {
                const email = user.email;
                const uid = user.uid;
                document.getElementById("user-email").textContent = "User Email: " + email;
            }
        });

        document.getElementById('logout').addEventListener("click", function () {
            logout();
        });

        function logout() {
            signOut(auth).then(function () {
                document.getElementById("user-email").textContent = "";
                window.location.href = 'http://127.0.0.1:5500/index.html';
            }).catch(function (error) {
                console.error("Error logging out: " + error.message);
            });
        }


        const user = auth.currentUser;
        if (user !== null) {
            const userEmail = user.email;
            document.getElementById("user-email").textContent = "User Email: " + userEmail;
            displayAssignedTasksForUser(userEmail);
        }
    });
    // Initialize Firebase (Use the same Firebase configuration as in your original HTML file)

// Function to fetch and display assigned tasks
function fetchAssignedTasks() {
    const user = auth.currentUser;

    if (user !== null) {
        const uid = user.uid;
        const assignedTasksRef = ref(database, `assignedTasks/${uid}`);

        get(assignedTasksRef).then((snapshot) => {
            const taskList = document.getElementById("task-list");
            taskList.innerHTML = ''; // Clear the task list

            if (snapshot.exists()) {
                const data = snapshot.val();

                for (const taskId in data) {
                    const task = data[taskId];
                    const listItem = document.createElement("li");
                    listItem.textContent = `Task: ${task.taskName}, Priority: ${task.priority}`;
                    taskList.appendChild(listItem);
                }
            } else {
                const message = document.createElement("p");
                message.textContent = "No assigned tasks found.";
                taskList.appendChild(message);
            }
        }).catch((error) => {
            console.error("Error fetching assigned tasks: " + error.message);
        });
    }
}

// Call the function to fetch and display assigned tasks when the page loads
window.addEventListener("load", fetchAssignedTasks);

</script>

</html>